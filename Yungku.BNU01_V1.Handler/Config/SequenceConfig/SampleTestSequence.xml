<?xml version="1.0" encoding="utf-8"?>
<!--
  测试序列配置文件示例
  用于 ActionSequenceTest 动作类
  
  作者：开发团队
  版本：1.0
  创建时间：2024
  
  使用方法：
  1. 在 ActionSequenceTest 的 SequenceFilePath 属性中指定此文件路径
  2. 可指定 SequenceId 来选择执行哪个序列，为空则执行第一个序列
  
  步骤类型 (StepType) 说明：
  - NumericTest: 数值测试，返回数值并与 Limits 限值比较
  - StringTest: 字符串测试，返回字符串并与 ExpectedString 匹配
  - PassFail: 逻辑判断，返回布尔值
  - Action: 动作执行，无返回值
  - ForLoop: For循环
  - WhileLoop: While循环
  - ForEachLoop: ForEach循环
  - ConditionalBranch: 条件分支
  - SequenceGroup: 步骤组
  - SubSequenceCall: 子序列调用
  
  失败处理 (OnFail) 说明：
  - Continue: 继续执行下一步骤
  - Abort: 中断整个序列
  - GotoStep: 跳转到指定步骤
  - Retry: 重试当前步骤
  - GotoPostCondition: 跳转到后置条件
-->
<TestSequenceConfig Version="1.0" Name="标准测试序列配置">
  
  <!-- 主测试序列 -->
  <Sequence ID="SEQ_MAIN" Name="主测试序列" Description="完整的产品测试流程" Enabled="true" Version="1.0" Author="开发团队">
    
    <!-- 序列级变量定义 -->
    <Variables>
      <Variable Name="ProductBarcode" Type="string" DefaultValue="" Description="产品二维码" Scope="Sequence"/>
      <Variable Name="TestCount" Type="int" DefaultValue="0" Description="测试计数" Scope="Sequence"/>
      <Variable Name="TotalVoltage" Type="double" DefaultValue="0" Description="总电压" Scope="Sequence"/>
      <Variable Name="TestResults" Type="double[]" DefaultValue="0,0,0,0,0" ArraySize="5" Description="测试结果数组" Scope="Sequence"/>
    </Variables>
    
    <Steps>
      <!-- 步骤1: 初始化 -->
      <Step ID="STEP_INIT" Name="初始化测试环境" Type="PassFail" Enabled="true" Timeout="10000" OnFail="Abort">
        <TargetMethod Class="CommonTestMethods" Method="Initialize"/>
        <Parameters>
          <Param Name="timeout" Type="int" Value="5000"/>
        </Parameters>
      </Step>
      
      <!-- 步骤2: 二维码读取 -->
      <Step ID="STEP_BARCODE" Name="读取产品二维码" Type="StringTest" Enabled="true" Timeout="5000" OnFail="Continue" RetryCount="2" ResultVariable="ProductBarcode">
        <TargetMethod Class="CommonTestMethods" Method="ReadBarcode"/>
        <!-- 字符串测试不需要指定ExpectedString时，表示只需读取成功即可 -->
      </Step>
      
      <!-- 步骤3: 二维码验证 -->
      <Step ID="STEP_BARCODE_VALIDATE" Name="验证二维码格式" Type="PassFail" Enabled="true" Timeout="3000" OnFail="Abort">
        <Precondition>${ProductBarcode} != ""</Precondition>
        <TargetMethod Class="CommonTestMethods" Method="ValidateBarcode"/>
        <Parameters>
          <Param Name="barcode" Type="string" Value="${ProductBarcode}"/>
          <Param Name="expectedPrefix" Type="string" Value="SN"/>
        </Parameters>
      </Step>
      
      <!-- 步骤4: 电压测试 -->
      <Step ID="STEP_VOLTAGE" Name="电压测试" Type="NumericTest" Enabled="true" Timeout="5000" OnFail="Continue" ResultVariable="TotalVoltage">
        <TargetMethod Class="CommonTestMethods" Method="TestVoltage"/>
        <Parameters>
          <Param Name="channel" Type="int" Value="0"/>
        </Parameters>
        <Limits Lower="2.8" Upper="3.8" Unit="V" Precision="3" CompareMode="GE_LE"/>
      </Step>
      
      <!-- 步骤5: 电流测试 -->
      <Step ID="STEP_CURRENT" Name="电流测试" Type="NumericTest" Enabled="true" Timeout="5000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestCurrent"/>
        <Parameters>
          <Param Name="channel" Type="int" Value="0"/>
        </Parameters>
        <Limits Lower="15" Upper="25" Unit="mA" Precision="2" CompareMode="GE_LE"/>
      </Step>
      
      <!-- 步骤6: 功率测试 -->
      <Step ID="STEP_POWER" Name="功率测试" Type="NumericTest" Enabled="true" Timeout="5000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestPower"/>
        <Limits Lower="0.3" Upper="0.8" Unit="W" Precision="3" CompareMode="GE_LE"/>
      </Step>
      
      <!-- 步骤7: 焦距测试 -->
      <Step ID="STEP_FOCAL" Name="焦距测试" Type="NumericTest" Enabled="true" Timeout="8000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestFocalLength"/>
        <Parameters>
          <Param Name="productIndex" Type="int" Value="0"/>
        </Parameters>
        <Limits Lower="3.7" Upper="4.3" Unit="mm" Precision="3" CompareMode="GE_LE"/>
      </Step>
      
      <!-- 步骤8: 色温测试 -->
      <Step ID="STEP_CCT" Name="色温测试" Type="NumericTest" Enabled="true" Timeout="8000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestColorTemperature"/>
        <Limits Lower="2700" Upper="6500" Unit="K" Precision="0" CompareMode="GE_LE"/>
      </Step>
      
      <!-- 步骤9: 亮度测试 -->
      <Step ID="STEP_BRIGHTNESS" Name="亮度测试" Type="NumericTest" Enabled="true" Timeout="8000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestBrightness"/>
        <Parameters>
          <Param Name="productIndex" Type="int" Value="0"/>
        </Parameters>
        <Limits Lower="800" Upper="1200" Unit="lux" Precision="1" CompareMode="GE_LE"/>
      </Step>
      
      <!-- 步骤10: 均匀度测试 -->
      <Step ID="STEP_UNIFORMITY" Name="均匀度测试" Type="NumericTest" Enabled="true" Timeout="8000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestUniformity"/>
        <Limits Lower="85" Upper="100" Unit="%" Precision="1" CompareMode="GE_LE"/>
      </Step>
      
      <!-- 步骤11: 脏污检测 -->
      <Step ID="STEP_CONTAMINATION" Name="脏污检测" Type="PassFail" Enabled="true" Timeout="10000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestContamination"/>
      </Step>
      
      <!-- 步骤12: 划痕检测 -->
      <Step ID="STEP_SCRATCH" Name="划痕检测" Type="NumericTest" Enabled="true" Timeout="10000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestScratch"/>
        <Limits Lower="0" Upper="1" Unit="处" Precision="0" CompareMode="GE_LE"/>
      </Step>
      
      <!-- 步骤13: 清理 -->
      <Step ID="STEP_CLEANUP" Name="清理测试环境" Type="PassFail" Enabled="true" Timeout="5000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="Cleanup"/>
      </Step>
    </Steps>
  </Sequence>
  
  <!-- 快速测试序列（简化版） -->
  <Sequence ID="SEQ_QUICK" Name="快速测试序列" Description="简化的快速测试流程" Enabled="true" Version="1.0">
    <Steps>
      <!-- 电压测试 -->
      <Step ID="QUICK_VOLTAGE" Name="快速电压测试" Type="NumericTest" Enabled="true" Timeout="3000" OnFail="Abort">
        <TargetMethod Class="CommonTestMethods" Method="TestVoltage"/>
        <Parameters>
          <Param Name="channel" Type="int" Value="0"/>
        </Parameters>
        <Limits Lower="2.8" Upper="3.8" Unit="V" Precision="3" CompareMode="GE_LE"/>
      </Step>
      
      <!-- 电流测试 -->
      <Step ID="QUICK_CURRENT" Name="快速电流测试" Type="NumericTest" Enabled="true" Timeout="3000" OnFail="Abort">
        <TargetMethod Class="CommonTestMethods" Method="TestCurrent"/>
        <Parameters>
          <Param Name="channel" Type="int" Value="0"/>
        </Parameters>
        <Limits Lower="15" Upper="25" Unit="mA" Precision="2" CompareMode="GE_LE"/>
      </Step>
      
      <!-- 亮度测试 -->
      <Step ID="QUICK_BRIGHTNESS" Name="快速亮度测试" Type="NumericTest" Enabled="true" Timeout="5000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestBrightness"/>
        <Limits Lower="800" Upper="1200" Unit="lux" Precision="1" CompareMode="GE_LE"/>
      </Step>
    </Steps>
  </Sequence>
  
  <!-- 循环测试示例 -->
  <Sequence ID="SEQ_LOOP" Name="循环测试序列" Description="演示循环和条件分支功能" Enabled="true" Version="1.0">
    <Variables>
      <Variable Name="loopCount" Type="int" DefaultValue="3" Description="循环次数"/>
      <Variable Name="voltageSum" Type="double" DefaultValue="0" Description="电压累加"/>
    </Variables>
    
    <Steps>
      <!-- For循环示例 -->
      <Step ID="FOR_LOOP_TEST" Name="多次电压测试" Type="ForLoop" Enabled="true" LoopStart="0" LoopEnd="2" LoopStep="1" LoopVariable="i" MaxIterations="10">
        <SubSteps>
          <Step ID="LOOP_VOLTAGE" Name="循环电压测试" Type="NumericTest" Enabled="true" Timeout="3000" OnFail="Continue">
            <TargetMethod Class="CommonTestMethods" Method="TestVoltage"/>
            <Parameters>
              <Param Name="channel" Type="int" Value="${i}"/>
            </Parameters>
            <Limits Lower="2.8" Upper="3.8" Unit="V" Precision="3" CompareMode="GE_LE"/>
          </Step>
        </SubSteps>
      </Step>
      
      <!-- 条件分支示例 -->
      <Step ID="CONDITION_TEST" Name="条件判断测试" Type="ConditionalBranch" Enabled="true">
        <BranchCondition>${voltageSum} > 5</BranchCondition>
        <TrueSteps>
          <Step ID="HIGH_VOLTAGE_LOG" Name="高电压日志" Type="Action" Enabled="true">
            <TargetMethod Class="CommonTestMethods" Method="LogMessage"/>
            <Parameters>
              <Param Name="message" Type="string" Value="电压总和超过5V"/>
            </Parameters>
          </Step>
        </TrueSteps>
        <FalseSteps>
          <Step ID="NORMAL_VOLTAGE_LOG" Name="正常电压日志" Type="Action" Enabled="true">
            <TargetMethod Class="CommonTestMethods" Method="LogMessage"/>
            <Parameters>
              <Param Name="message" Type="string" Value="电压总和正常"/>
            </Parameters>
          </Step>
        </FalseSteps>
      </Step>
    </Steps>
  </Sequence>
  
  <!-- 多产品同时测试示例 -->
  <Sequence ID="SEQ_MULTI_PRODUCT" Name="多产品同时测试序列" Description="演示如何同时测试多个产品并在UI中区分显示" Enabled="true" Version="1.0">
    <Variables>
      <Variable Name="ProductCount" Type="int" DefaultValue="4" Description="同时测试的产品数量"/>
    </Variables>
    
    <Steps>
      <!-- 使用循环测试多个产品 -->
      <Step ID="MULTI_VOLTAGE_LOOP" Name="多产品电压测试" Type="ForLoop" Enabled="true" 
            LoopStart="0" LoopEnd="3" LoopStep="1" LoopVariable="productIdx" MaxIterations="4">
        <SubSteps>
          <!-- 测试名称包含产品索引，便于UI区分 -->
          <Step ID="MULTI_VOLTAGE_TEST" Name="[P${productIdx}] 电压测试" Type="NumericTest" Enabled="true" Timeout="3000" OnFail="Continue">
            <TargetMethod Class="CommonTestMethods" Method="TestVoltage"/>
            <Parameters>
              <Param Name="channel" Type="int" Value="${productIdx}"/>
            </Parameters>
            <Limits Lower="2.8" Upper="3.8" Unit="V" Precision="3" CompareMode="GE_LE"/>
          </Step>
        </SubSteps>
      </Step>
      
      <!-- 多产品电流测试 -->
      <Step ID="MULTI_CURRENT_LOOP" Name="多产品电流测试" Type="ForLoop" Enabled="true" 
            LoopStart="0" LoopEnd="3" LoopStep="1" LoopVariable="productIdx" MaxIterations="4">
        <SubSteps>
          <Step ID="MULTI_CURRENT_TEST" Name="[P${productIdx}] 电流测试" Type="NumericTest" Enabled="true" Timeout="3000" OnFail="Continue">
            <TargetMethod Class="CommonTestMethods" Method="TestCurrent"/>
            <Parameters>
              <Param Name="channel" Type="int" Value="${productIdx}"/>
            </Parameters>
            <Limits Lower="15" Upper="25" Unit="mA" Precision="2" CompareMode="GE_LE"/>
          </Step>
        </SubSteps>
      </Step>
      
      <!-- 或者直接为每个产品创建独立步骤（适用于产品数量固定的情况） -->
      <Step ID="P0_BRIGHTNESS" Name="[Product0] 亮度测试" Type="NumericTest" Enabled="true" Timeout="5000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestBrightness"/>
        <Parameters>
          <Param Name="productIndex" Type="int" Value="0"/>
        </Parameters>
        <Limits Lower="800" Upper="1200" Unit="lux" Precision="1" CompareMode="GE_LE"/>
      </Step>
      
      <Step ID="P1_BRIGHTNESS" Name="[Product1] 亮度测试" Type="NumericTest" Enabled="true" Timeout="5000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestBrightness"/>
        <Parameters>
          <Param Name="productIndex" Type="int" Value="1"/>
        </Parameters>
        <Limits Lower="800" Upper="1200" Unit="lux" Precision="1" CompareMode="GE_LE"/>
      </Step>
    </Steps>
  </Sequence>
  
  <!-- 不同产品类型测试示例 -->
  <Sequence ID="SEQ_TYPE_A" Name="A类产品测试序列" Description="A类产品专用测试流程" Enabled="true" Version="1.0">
    <Steps>
      <Step ID="TYPE_A_INIT" Name="[TypeA] 初始化" Type="PassFail" Enabled="true" Timeout="5000" OnFail="Abort">
        <TargetMethod Class="CommonTestMethods" Method="Initialize"/>
      </Step>
      
      <Step ID="TYPE_A_VOLTAGE" Name="[TypeA] 电压测试" Type="NumericTest" Enabled="true" Timeout="5000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestVoltage"/>
        <Limits Lower="3.0" Upper="3.6" Unit="V" Precision="3" CompareMode="GE_LE"/>
      </Step>
      
      <Step ID="TYPE_A_FOCAL" Name="[TypeA] 焦距测试" Type="NumericTest" Enabled="true" Timeout="8000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestFocalLength"/>
        <Limits Lower="3.5" Upper="4.0" Unit="mm" Precision="3" CompareMode="GE_LE"/>
      </Step>
    </Steps>
  </Sequence>
  
  <Sequence ID="SEQ_TYPE_B" Name="B类产品测试序列" Description="B类产品专用测试流程" Enabled="true" Version="1.0">
    <Steps>
      <Step ID="TYPE_B_INIT" Name="[TypeB] 初始化" Type="PassFail" Enabled="true" Timeout="5000" OnFail="Abort">
        <TargetMethod Class="CommonTestMethods" Method="Initialize"/>
      </Step>
      
      <Step ID="TYPE_B_CURRENT" Name="[TypeB] 电流测试" Type="NumericTest" Enabled="true" Timeout="5000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestCurrent"/>
        <Limits Lower="18" Upper="22" Unit="mA" Precision="2" CompareMode="GE_LE"/>
      </Step>
      
      <Step ID="TYPE_B_CCT" Name="[TypeB] 色温测试" Type="NumericTest" Enabled="true" Timeout="8000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="TestColorTemperature"/>
        <Limits Lower="4000" Upper="5000" Unit="K" Precision="0" CompareMode="GE_LE"/>
      </Step>
    </Steps>
  </Sequence>
  
  <!-- 老化测试序列示例 - 支持多轮循环测试 -->
  <Sequence ID="SEQ_AGING" Name="老化测试序列" Description="支持多轮循环的老化/烧机测试" Enabled="true" Version="1.0">
    <Variables>
      <Variable Name="TestRound" Type="int" DefaultValue="0" Description="当前测试轮次"/>
      <Variable Name="MaxRounds" Type="int" DefaultValue="10" Description="最大测试轮次（可配置）"/>
      <Variable Name="RoundPassCount" Type="int" DefaultValue="0" Description="每轮通过计数"/>
      <Variable Name="RoundFailCount" Type="int" DefaultValue="0" Description="每轮失败计数"/>
    </Variables>
    
    <Steps>
      <!-- 初始化 -->
      <Step ID="AGING_INIT" Name="[老化] 初始化" Type="PassFail" Enabled="true" Timeout="5000" OnFail="Abort">
        <TargetMethod Class="CommonTestMethods" Method="Initialize"/>
      </Step>
      
      <!-- 外层循环：控制测试轮次 -->
      <Step ID="AGING_LOOP" Name="老化循环" Type="ForLoop" Enabled="true" 
            LoopStart="1" LoopEnd="10" LoopStep="1" LoopVariable="round" MaxIterations="100">
        <SubSteps>
          <!-- 轮次开始日志 -->
          <Step ID="ROUND_START" Name="[Round${round}] 开始" Type="Action" Enabled="true">
            <TargetMethod Class="CommonTestMethods" Method="LogMessage"/>
            <Parameters>
              <Param Name="message" Type="string" Value="开始第${round}轮老化测试"/>
            </Parameters>
          </Step>
          
          <!-- 本轮电压测试 -->
          <Step ID="AGING_VOLTAGE" Name="[Round${round}] 电压测试" Type="NumericTest" Enabled="true" Timeout="5000" OnFail="Continue">
            <TargetMethod Class="CommonTestMethods" Method="TestVoltage"/>
            <Limits Lower="2.8" Upper="3.8" Unit="V" Precision="3" CompareMode="GE_LE"/>
          </Step>
          
          <!-- 本轮电流测试 -->
          <Step ID="AGING_CURRENT" Name="[Round${round}] 电流测试" Type="NumericTest" Enabled="true" Timeout="5000" OnFail="Continue">
            <TargetMethod Class="CommonTestMethods" Method="TestCurrent"/>
            <Limits Lower="15" Upper="25" Unit="mA" Precision="2" CompareMode="GE_LE"/>
          </Step>
          
          <!-- 本轮功率测试 -->
          <Step ID="AGING_POWER" Name="[Round${round}] 功率测试" Type="NumericTest" Enabled="true" Timeout="5000" OnFail="Continue">
            <TargetMethod Class="CommonTestMethods" Method="TestPower"/>
            <Limits Lower="0.3" Upper="0.8" Unit="W" Precision="3" CompareMode="GE_LE"/>
          </Step>
          
          <!-- 轮次间延时（老化测试通常需要间隔时间） -->
          <Step ID="ROUND_DELAY" Name="[Round${round}] 等待下一轮" Type="Action" Enabled="true" Timeout="70000">
            <TargetMethod Class="CommonTestMethods" Method="Delay"/>
            <Parameters>
              <Param Name="milliseconds" Type="int" Value="60000"/>
            </Parameters>
          </Step>
        </SubSteps>
      </Step>
      
      <!-- 老化测试完成 -->
      <Step ID="AGING_COMPLETE" Name="[老化] 测试完成" Type="PassFail" Enabled="true" Timeout="5000" OnFail="Continue">
        <TargetMethod Class="CommonTestMethods" Method="Cleanup"/>
      </Step>
    </Steps>
  </Sequence>
  
  <!-- 工位分组测试示例 - 适用于多工位配对测试 -->
  <Sequence ID="SEQ_STATION_GROUP" Name="工位分组测试" Description="演示如何根据工位编号执行不同测试" Enabled="true" Version="1.0">
    <Variables>
      <Variable Name="StationIndex" Type="int" DefaultValue="0" Description="当前工位索引（由系统设置）"/>
    </Variables>
    
    <Steps>
      <!-- 根据工位奇偶性执行不同测试 -->
      <Step ID="STATION_BRANCH" Name="工位分支判断" Type="ConditionalBranch" Enabled="true">
        <BranchCondition>${StationIndex} % 2 == 0</BranchCondition>
        <TrueSteps>
          <!-- 偶数工位（0, 2, 4...）测试A类产品 -->
          <Step ID="EVEN_STATION_TEST" Name="[偶数工位] 产品A测试" Type="NumericTest" Enabled="true" Timeout="5000">
            <TargetMethod Class="CommonTestMethods" Method="TestVoltage"/>
            <Parameters>
              <Param Name="channel" Type="int" Value="${StationIndex}"/>
            </Parameters>
            <Limits Lower="2.8" Upper="3.8" Unit="V" Precision="3" CompareMode="GE_LE"/>
          </Step>
        </TrueSteps>
        <FalseSteps>
          <!-- 奇数工位（1, 3, 5...）测试B类产品 -->
          <Step ID="ODD_STATION_TEST" Name="[奇数工位] 产品B测试" Type="NumericTest" Enabled="true" Timeout="5000">
            <TargetMethod Class="CommonTestMethods" Method="TestCurrent"/>
            <Parameters>
              <Param Name="channel" Type="int" Value="${StationIndex}"/>
            </Parameters>
            <Limits Lower="15" Upper="25" Unit="mA" Precision="2" CompareMode="GE_LE"/>
          </Step>
        </FalseSteps>
      </Step>
    </Steps>
  </Sequence>
  
</TestSequenceConfig>
